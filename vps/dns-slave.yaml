version: "3.6"

services:

  external-resolver:
    image: "docker.io/alpinelinux/unbound:latest"
    labels:
      com.centurylinklabs.watchtower.enable: "true"
    networks:
      internal-net:
        ipv4_address: 172.18.2.2
      external-net:
        ipv4_address: 172.17.31.10
    ports:
      - "127.0.0.1:53:53/udp"
    restart: "unless-stopped"
    volumes:
      - "/usr/share/dns/root.hints:/etc/unbound/root.hints"
      - "/etc/ssl/certs/ca-certificates.crt:/etc/unbound/ca-certificates.crt"
      - "external-resolver-unbound:/etc/unbound"
    working_dir: "/etc/unbound"

  auth-slave:
    image: "docker.io/powerdns/pdns-auth-48:latest"
    labels:
      com.centurylinklabs.watchtower.enable: "true"
    networks:
      internal-net:
        ipv4_address: 172.18.2.3
      external-net:
        ipv4_address: 172.17.31.11
    ports:
      - "127.0.0.1:5353:53/udp"
    restart: "unless-stopped"
    volumes:
      - "auth-slave-pdns:/etc/powerdns/pdns.d"
    working_dir: "/etc/powerdns"

volumes:
  external-resolver-unbound:
  auth-slave-pdns:
  
networks:
  internal-net:
    driver: bridge
    internal: true
    ipam:
      config:
        - subnet: 172.18.2.0/29
  external-net:
    driver: bridge
    ipam:
      config:
        - subnet: 172.17.31.8/29        
